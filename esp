local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local espList = {}

local function getRainbowColor(t)
	return Color3.fromHSV((t % 5) / 5, 1, 1)
end

local function createESP(player)
	if player == LocalPlayer then return end
	local char = player.Character
	if not char then return end
	local head = char:FindFirstChild("Head")
	if not head then return end

	local nameGui = Instance.new("BillboardGui")
	nameGui.AlwaysOnTop = true
	nameGui.Size = UDim2.new(0, 100, 0, 20)
	nameGui.StudsOffset = Vector3.new(0, 2.5, 0)
	nameGui.Adornee = head

	local label = Instance.new("TextLabel")
	label.BackgroundTransparency = 1
	label.Size = UDim2.new(1, 0, 1, 0)
	label.Text = player.Name
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.TextStrokeTransparency = 0.2
	label.TextColor3 = Color3.fromRGB(255, 255, 255)
	label.Parent = nameGui
	nameGui.Parent = head

	espList[player] = {
		gui = nameGui,
		text = label,
		char = char
	}
end

local function removeESP(player)
	local esp = espList[player]
	if esp and esp.gui then
		esp.gui:Destroy()
	end
	espList[player] = nil
end

RunService.RenderStepped:Connect(function()
	local t = tick()
	for player, esp in pairs(espList) do
		if player and esp.char and esp.char.Parent then
			esp.text.TextColor3 = getRainbowColor(t)
		else
			removeESP(player)
		end
	end
end)

for _, player in ipairs(Players:GetPlayers()) do
	createESP(player)
	player.CharacterAdded:Connect(function()
		wait(1)
		createESP(player)
	end)
end

Players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function()
		wait(1)
		createESP(player)
	end)
end)

Players.PlayerRemoving:Connect(removeESP)
